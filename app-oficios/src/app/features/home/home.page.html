<!-- Navbar -->
<nav class="navbar">
  <div class="navbar-container">
    <!-- Chat Button (Left) -->
    <div class="navbar-left">
      <button class="btn-chat" (click)="goToChat()">
        <lucide-angular [img]="MessageCircle" size="20"></lucide-angular>
        <span>Chats</span>
      </button>
    </div>

    <!-- Search Bar (Center) -->
    <div class="navbar-center">
      <div class="search-container">
        <div class="search-input-wrapper">
          <lucide-angular [img]="Search" size="20" class="search-icon"></lucide-angular>
          <input
            type="text"
            placeholder="Buscar servicio, ubicación o profesional..."
            class="search-input"
            [(ngModel)]="searchQuery"
            (keyup.enter)="onSearch()"
          >
        </div>
        <button class="search-btn" (click)="onSearch()">Buscar</button>
      </div>
    </div>

    <!-- User Dropdown (Right) -->
    <div class="navbar-right">
      <div class="user-dropdown">
        <!-- Authenticated User -->
        <button
          *ngIf="isUserAuthenticated()"
          class="dropdown-btn authenticated"
          [class.active]="isDropdownOpen()"
          (click)="toggleDropdown()"
        >
          <lucide-angular [img]="User" size="18"></lucide-angular>
          <span>{{ getUserDisplayName() }}</span>
          <lucide-angular [img]="ChevronDown" size="16"></lucide-angular>
        </button>

        <!-- Guest User -->
        <button
          *ngIf="!isUserAuthenticated()"
          class="dropdown-btn"
          [class.active]="isDropdownOpen()"
          (click)="toggleDropdown()"
        >
          <lucide-angular [img]="User" size="18"></lucide-angular>
          <span>Cuenta</span>
          <lucide-angular [img]="ChevronDown" size="16"></lucide-angular>
        </button>

        <!-- Authenticated Dropdown Menu -->
        <div *ngIf="isUserAuthenticated()" class="dropdown-menu" [class.show]="isDropdownOpen()">
          <button class="dropdown-item profile" (click)="goToProfile()">
            <lucide-angular [img]="Settings" size="16"></lucide-angular>
            <span>Perfil</span>
          </button>
          <button class="dropdown-item trabajos" routerlink="/trabajos">
            <lucide-angular [img]="Briefcase" size="16"></lucide-angular>
            <span>Mis Trabajos</span>
          </button>
          <button *ngIf="isProfessional()" class="dropdown-item dashboard" (click)="goToDashboard()">
            <lucide-angular [img]="Briefcase" size="16"></lucide-angular>
            <span>Dashboard Profesional</span>
          </button>
          <button *ngIf="!isProfessional()" class="dropdown-item register-professional" (click)="goToRegisterProfessional()">
            <lucide-angular [img]="Briefcase" size="16"></lucide-angular>
            <span>Registrarse como Profesional</span>
          </button>
          <button class="dropdown-item logout" (click)="logout()">
            <lucide-angular [img]="LogOut" size="16"></lucide-angular>
            <span>Cerrar Sesión</span>
          </button>
        </div>

        <!-- Guest Dropdown Menu -->
        <div *ngIf="!isUserAuthenticated()" class="dropdown-menu" [class.show]="isDropdownOpen()">
          <button class="dropdown-item signin" (click)="goToSignIn()">
            <lucide-angular [img]="LogIn" size="16"></lucide-angular>
            <span>Iniciar Sesión</span>
          </button>
          <button class="dropdown-item signup" (click)="goToSignUp()">
            <lucide-angular [img]="UserPlus" size="16"></lucide-angular>
            <span>Registrarse</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="home-container">
  <div class="home-content">

    <!-- Services View -->
    <div *ngIf="!showProfessionals()">
      <!-- Hero Section -->
      <section class="hero-section">
        <div class="hero-content">
          <h1 class="hero-title">Encuentra profesionales locales de confianza</h1>
          <p class="hero-subtitle">Conecta con profesionales cualificados en tu zona. Obtén presupuestos, lee reseñas y reserva servicios con total tranquilidad.</p>
        </div>
      </section>

      <!-- How It Works Section -->
      <section class="how-it-works-section">
        <div class="section-header">
          <h2 class="section-title">¿Cómo funciona?</h2>
          <p class="section-subtitle">Obtener ayuda profesional para tu hogar o negocio nunca ha sido tan fácil. Sigue estos sencillos pasos para conectar con profesionales de confianza.</p>
        </div>

        <div class="steps-grid">
          <div class="step-card">
            <div class="step-number">1</div>
            <div class="step-icon">
              <lucide-angular [img]="Search" size="32"></lucide-angular>
            </div>
            <h3 class="step-title">Search & Browse</h3>
            <p class="step-description">Find qualified professionals in your area by service type, location, and ratings.</p>
          </div>

          <div class="step-card">
            <div class="step-number">2</div>
            <div class="step-icon">
              <lucide-angular [img]="Users" size="32"></lucide-angular>
            </div>
            <h3 class="step-title">Compare & Choose</h3>
            <p class="step-description">Review profiles, portfolios, and customer reviews to select the right professional.</p>
          </div>

          <div class="step-card">
            <div class="step-number">3</div>
            <div class="step-icon">
              <lucide-angular [img]="CalendarCheck" size="32"></lucide-angular>
            </div>
            <h3 class="step-title">Book & Schedule</h3>
            <p class="step-description">Request quotes, schedule appointments, and communicate directly with professionals.</p>
          </div>

          <div class="step-card">
            <div class="step-number">4</div>
            <div class="step-icon">
              <lucide-angular [img]="CheckCircle" size="32"></lucide-angular>
            </div>
            <h3 class="step-title">Get It Done</h3>
            <p class="step-description">Enjoy quality service with our satisfaction guarantee and secure payment protection.</p>
          </div>
        </div>
      </section>

      <!-- Services Catalog -->
      <main class="services-section">
        <div class="section-header">
          <h2 class="section-title">Servicios Populares</h2>
          <p class="section-subtitle">Filtra por categoría para encontrar el profesional que buscas</p>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoadingServices()" class="loading-container">
          <p>Cargando servicios...</p>
        </div>

        <!-- Services Grid -->
        <div *ngIf="!isLoadingServices()" class="services-grid">
          <div
            *ngFor="let service of services()"
            class="service-card"
          >
            <!-- Service Icon (Large) -->
            <div class="service-icon">
              <img [src]="service.image" [alt]="service.title" onerror="this.src='assets/logos/logo.png'">
            </div>

            <!-- Card Content -->
            <div class="service-content">
              <h3 class="service-title">{{ service.title }}</h3>
              <p class="service-description">{{ service.description }}</p>

              <button class="view-professionals-btn" (click)="viewServiceProfessionals(service)">
                Ver Profesionales
              </button>
            </div>
          </div>
        </div>
      </main>

      <!-- Featured Professionals Section -->
      <section class="featured-professionals-section">
        <div class="section-header">
          <h2 class="section-title">Profesionales destacados</h2>
          <p class="section-subtitle">Conecta con los mejores profesionales de tu zona. Todos nuestros profesionales destacados cuentan con licencia, seguro y excelentes valoraciones de los clientes.</p>
        </div>

        <div class="professionals-grid">
          <div *ngFor="let professional of featuredProfessionals()" class="professional-card featured">
            <!-- Professional Image -->
            <div class="professional-image">
              <img [src]="professional.image" [alt]="professional.name" onerror="this.src='assets/logos/logo.png'">
              <div class="verified-badge">
                <lucide-angular [img]="Award" size="16"></lucide-angular>
              </div>
            </div>

            <!-- Professional Content -->
            <div class="professional-content">
              <div class="professional-header">
                <h3 class="professional-name">{{ professional.name }}</h3>
                <div class="professional-rating">
                  <lucide-angular [img]="Star" size="14" class="star-icon"></lucide-angular>
                  <span class="rating-value">{{ professional.rating }}</span>
                  <span class="review-count">({{ professional.reviewCount }})</span>
                </div>
              </div>

              <p class="professional-service">{{ professional.service }}</p>

              <div class="professional-info">
                <div class="info-item">
                  <lucide-angular [img]="MapPin" size="14" class="info-icon"></lucide-angular>
                  <span>{{ professional.location }}</span>
                </div>
                <div class="info-item">
                  <lucide-angular [img]="Clock" size="14" class="info-icon"></lucide-angular>
                  <span>{{ professional.experience }}</span>
                </div>
              </div>

              <div class="professional-footer">
                <div class="professional-price">
                  <span class="price-label">Desde</span>
                  <span class="price-value">${{ professional.price }}</span>
                </div>
                <button class="contact-professional-btn" (click)="contactProfessional(professional)">
                  Contactar
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Professionals View -->
    <div *ngIf="showProfessionals()">
      <!-- Header with Back Button -->
      <section class="professionals-header">
        <button class="back-btn" (click)="backToServices()">
          <lucide-angular [img]="ArrowLeft" size="20"></lucide-angular>
          <span>Volver a Servicios</span>
        </button>
        <div class="service-info">
          <h1 class="service-title">{{ selectedService()?.title }}</h1>
          <p class="service-subtitle">{{ selectedService()?.professionalCount }} profesionales disponibles</p>
        </div>
      </section>

      <!-- Professionals List -->
      <main class="professionals-section">
        <!-- Loading State -->
        <div *ngIf="isLoadingProfessionals()" class="loading-container">
          <p>Cargando profesionales...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoadingProfessionals() && noProfessionalsFound()" class="empty-state">
          <div class="empty-state-icon">
            <lucide-angular [img]="Users" size="64"></lucide-angular>
          </div>
          <h3 class="empty-state-title">No hay profesionales disponibles</h3>
          <p class="empty-state-message">
            Actualmente no hay profesionales registrados para el servicio de <strong>{{ selectedService()?.title }}</strong>.
            Te invitamos a revisar otros servicios o volver más tarde.
          </p>
        </div>

        <!-- Professionals Grid -->
        <div *ngIf="!isLoadingProfessionals() && !noProfessionalsFound()" class="professionals-grid">
          <app-professional-card
            *ngFor="let professional of getCurrentProfessionals()"
            [professional]="professional"
            (contact)="contactProfessional($event)"
          >
          </app-professional-card>
        </div>
      </main>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="app-footer">
  <div class="footer-container">
    <div class="footer-content">
      <!-- Company Info -->
      <div class="footer-section">
        <div class="footer-logo">
          <img src="assets/logos/logo-blanco.png" alt="Logo" class="logo">
          <h3>OficiosApp</h3>
        </div>
        <p>Conectamos profesionales con clientes de manera fácil y segura.</p>
      </div>

      <!-- Services -->
      <div class="footer-section">
        <h4>Servicios</h4>
        <ul>
          <li><a href="#">Plomería</a></li>
          <li><a href="#">Electricidad</a></li>
          <li><a href="#">Pintura</a></li>
          <li><a href="#">Carpintería</a></li>
        </ul>
      </div>

      <!-- Support -->
      <div class="footer-section">
        <h4>Soporte</h4>
        <ul>
          <li><a href="#">Centro de Ayuda</a></li>
          <li><a href="#">Contacto</a></li>
          <li><a href="#">FAQ</a></li>
          <li><a href="#">Términos y Condiciones</a></li>
        </ul>
      </div>

      <!-- Contact -->
      <div class="footer-section">
        <h4>Contacto</h4>
        <ul>
          <li>info@oficiosapp.com</li>
          <li>+54 11 1234-5678</li>
          <li>Buenos Aires, Argentina</li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; 2025 OficiosApp. Todos los derechos reservados.</p>
    </div>
  </div>
</footer>

<!-- Modal de Solicitud -->
<div *ngIf="showSolicitudModal()" class="modal-overlay" (click)="closeSolicitudModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Solicitar Servicio</h2>
      <button class="close-btn" (click)="closeSolicitudModal()">
        <lucide-angular [img]="X" size="24"></lucide-angular>
      </button>
    </div>

    <div class="modal-body">
      <div class="professional-info">
        <h3>{{ getProfessionalDisplayName(selectedProfessional()!) }}</h3>
        <p class="professional-oficio">{{ selectedProfessional()?.oficio }}</p>
        <p class="professional-phone">
          <lucide-angular [img]="User" size="16"></lucide-angular>
          {{ selectedProfessional()?.telefono }}
        </p>
      </div>

      <form [formGroup]="solicitudForm" (ngSubmit)="enviarSolicitud()">
        <div class="form-group">
          <label for="fechaservicio">Fecha del Servicio</label>
          <input
            type="date"
            id="fechaservicio"
            formControlName="fechaservicio"
            [min]="getMinDate()"
            class="form-control"
          >
          <div *ngIf="solicitudForm.get('fechaservicio')?.invalid && solicitudForm.get('fechaservicio')?.touched" class="error-message">
            La fecha es requerida y debe ser futura
          </div>
        </div>

        <div class="form-group">
          <label for="observacion">Observaciones</label>
          <textarea
            id="observacion"
            formControlName="observacion"
            rows="4"
            placeholder="Describe el servicio que necesitas..."
            class="form-control"
          ></textarea>
          <div *ngIf="solicitudForm.get('observacion')?.invalid && solicitudForm.get('observacion')?.touched" class="error-message">
            La observación es requerida (mínimo 10 caracteres)
          </div>
        </div>

        <div *ngIf="solicitudError()" class="alert alert-error">
          {{ solicitudError() }}
        </div>

        <div *ngIf="solicitudSuccess()" class="alert alert-success">
          <lucide-angular [img]="CheckCircle" size="20"></lucide-angular>
          ¡Solicitud enviada exitosamente!
        </div>

        <div class="modal-actions">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="closeSolicitudModal()"
            [disabled]="isSendingSolicitud()"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="solicitudForm.invalid || isSendingSolicitud()"
          >
            <lucide-angular *ngIf="!isSendingSolicitud()" [img]="Send" size="18"></lucide-angular>
            <span>{{ isSendingSolicitud() ? 'Enviando...' : 'Enviar Solicitud' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal de Advertencia - Solicitud Pendiente -->
<div *ngIf="showPendingSolicitudWarning()" class="modal-overlay" (click)="closePendingWarningModal()">
  <div class="modal-content modal-warning" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="warning-icon">
        <lucide-angular [img]="Clock" size="32" color="#f59e0b"></lucide-angular>
      </div>
      <h2>Solicitud Pendiente</h2>
      <button class="close-btn" (click)="closePendingWarningModal()">
        <lucide-angular [img]="X" size="24"></lucide-angular>
      </button>
    </div>

    <div class="modal-body">
      <div class="warning-content">
        <p class="warning-message">
          Ya tienes una <strong>solicitud pendiente</strong> con
          <strong>{{ getProfessionalDisplayName(selectedProfessional()!) }}</strong>.
        </p>
        <p class="warning-subtitle">
          Por favor espera a que el profesional responda tu solicitud actual antes de enviar una nueva.
        </p>
      </div>
    </div>

    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-primary btn-block"
        (click)="closePendingWarningModal()"
      >
        Entendido
      </button>
    </div>
  </div>
</div>

<!-- Modal de Turnos -->
<app-turno-modal
  *ngIf="showTurnoModal() && selectedProfessional()"
  [professional]="selectedProfessional()!"
  [idUsuario]="authService.currentUser()?.id!"
  (close)="closeTurnoModal()"
  (turnoConfirmado)="onTurnoConfirmado($event)"
></app-turno-modal>
